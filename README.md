# GitHub Actions 自动同步配置

本项目包含两个 GitHub Actions 工作流，用于自动同步上游仓库的更新，同时保护本地的 `本地仓.txt` 文件不被覆盖。

## 工作流文件

### 1. sync-upstream.yml
- **功能**: 使用原生 Git 命令进行同步
- **特点**: 更灵活的冲突处理，完全控制合并过程
- **执行时间**: 每天凌晨2点自动执行

### 2. sync-fork.yml  
- **功能**: 使用第三方 Action 进行同步
- **特点**: 更简单的配置，自动化程度更高
- **执行时间**: 每周日凌晨执行

## 使用前配置

### 重要：修改上游仓库地址

在使用前，你需要修改工作流文件中的上游仓库地址：

1. 打开 `.github/workflows/sync-upstream.yml`
2. 找到第 25 行左右的代码：
   ```yaml
   git remote add upstream https://github.com/原作者用户名/原仓库名.git
   ```
3. 将 `原作者用户名/原仓库名` 替换为实际的上游仓库地址

4. 打开 `.github/workflows/sync-fork.yml`
5. 找到第 28 行左右的代码：
   ```yaml
   upstream_sync_repo: 原作者用户名/原仓库名
   ```
6. 同样替换为实际的上游仓库地址

### 示例配置

如果你的项目是从 `https://github.com/example/original-repo` fork 的，那么应该修改为：

```yaml
# sync-upstream.yml 中
git remote add upstream https://github.com/example/original-repo.git

# sync-fork.yml 中
upstream_sync_repo: example/original-repo
```

## 工作原理

### 保护机制

两个工作流都会保护 `本地仓.txt` 文件：

1. **备份**: 在同步前备份本地文件
2. **合并**: 同步上游更新
3. **恢复**: 如果本地文件被覆盖，自动恢复
4. **提交**: 将保护后的文件提交到仓库

### 冲突处理

- **本地仓.txt**: 始终保持你的本地版本
- **其他文件**: 接受上游的更新版本
- **新文件**: 自动添加上游的新文件

## 手动触发

你可以在 GitHub 仓库的 Actions 页面手动触发同步：

1. 进入你的 GitHub 仓库
2. 点击 "Actions" 标签
3. 选择要运行的工作流
4. 点击 "Run workflow" 按钮

## 监控同步结果

同步完成后，你可以：

1. 查看 Actions 页面的执行日志
2. 检查最新的提交记录
3. 确认 `本地仓.txt` 文件内容未被更改

## 注意事项

1. **权限**: 确保 GitHub Actions 有推送到仓库的权限
2. **分支**: 默认同步 `main` 分支，如需其他分支请修改配置
3. **频率**: 可以根据需要调整执行频率
4. **备份**: 建议定期手动备份重要的本地修改

## 故障排除

### 常见问题

1. **同步失败**: 检查上游仓库地址是否正确
2. **权限错误**: 确保 GITHUB_TOKEN 有足够权限
3. **文件丢失**: 检查工作流日志，确认备份和恢复步骤

### 手动修复

如果自动同步出现问题，你可以：

1. 手动执行 Git 命令进行同步
2. 从备份恢复 `本地仓.txt` 文件
3. 禁用自动同步，改为手动操作

---

**提示**: 首次使用前，建议先手动触发一次工作流，确保配置正确。